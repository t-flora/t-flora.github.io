---
import Base from "@/layouts/Base.astro";

const meta = {
	title: "Contact",
	description: "Get in touch with me",
};

const { title } = meta;
---

<script>
	import emailjs from '@emailjs/browser';

	// Initialize EmailJS with your public key
	emailjs.init("IukdSiMfqY459eWNZ"); // Replace with your actual public key

	document.addEventListener('DOMContentLoaded', function() {
		const form = document.getElementById('contact-form') as HTMLFormElement;
		const submitButton = form?.querySelector('button[type="submit"]');
		const originalButtonText = submitButton?.textContent;

		form?.addEventListener('submit', async function(e) {
			e.preventDefault();

			if (!submitButton || !originalButtonText) return;

			// Update button state
      if ( submitButton instanceof HTMLButtonElement )
      {
        submitButton.disabled = true;
      }
			submitButton.textContent = 'Sending...';

			try {
				const result = await emailjs.sendForm(
					'service_82mx42m',    // Replace with your Gmail service ID
					'template_cr2ddja',   // Replace with your template ID
					form
				);

				console.log('Email sent successfully:', result);

				// Redirect to success page
				window.location.href = '/contact-success/';

			} catch (error) {
				console.error('Error sending email:', error);
				alert('Failed to send message. Please try again.');

				// Reset button state
				(submitButton as HTMLButtonElement).disabled = false;
				submitButton.textContent = originalButtonText;
			}
		});
	});
</script>

<Base meta={meta}>
	<div class="space-y-16">
		<header class="text-center">
			<h1 class="title">{title}</h1>
		</header>

		<div class="max-w-2xl mx-auto">
			<div class="prose prose-cactus">
				<p>I'd love to hear from you! Whether you have questions, feedback, or just want to say hi, feel free to reach out.</p>
			</div>

			<form
				id="contact-form"
				name="contact"
				class="mt-8 space-y-6"
			>

				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					<div>
						<label for="name" class="block text-sm font-medium text-textColor mb-2">
							Name *
						</label>
						<input
							type="text"
							id="name"
							name="name"
							required
							class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-accent focus:border-accent bg-bgColor dark:bg-gray-800 text-textColor"
							placeholder="Your name"
						/>
					</div>

					<div>
						<label for="email" class="block text-sm font-medium text-textColor mb-2">
							Email *
						</label>
						<input
							type="email"
							id="email"
							name="email"
							required
							class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-accent focus:border-accent bg-bgColor dark:bg-gray-800 text-textColor"
							placeholder="your.email@example.com"
						/>
					</div>
				</div>

				<div>
					<label for="subject" class="block text-sm font-medium text-textColor mb-2">
						Subject *
					</label>
					<input
						type="text"
						id="subject"
						name="subject"
						required
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-accent focus:border-accent bg-bgColor dark:bg-gray-800 text-textColor"
						placeholder="What's this about?"
					/>
				</div>

				<div>
					<label for="message" class="block text-sm font-medium text-textColor mb-2">
						Message *
					</label>
					<textarea
						id="message"
						name="message"
						rows="6"
						required
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-accent focus:border-accent bg-bgColor dark:bg-gray-800 text-textColor resize-vertical"
						placeholder="Your message..."
					></textarea>
				</div>

				<div class="pt-4">
					<button
						type="submit"
						class="w-full md:w-auto px-8 py-3 bg-accent text-white font-medium rounded-md hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 transition-colors duration-200"
					>
						Send Message
					</button>
				</div>
			</form>

			<div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
				<div class="prose prose-cactus text-sm">
					<p>This form is secured by EmailJS. Your information will be sent directly to me and is not stored or shared with third parties.</p>
				</div>
			</div>
		</div>
	</div>
</Base>
